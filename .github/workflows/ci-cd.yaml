name: SQL Lint and Pattern Check

on:
  push:
 

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Set up Python & Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install sqlfluff
          pip install -e ./sqlfluff-plugin-iceberg
   
      # - name: Debug - List all files
      #   run: |
      #     echo "ğŸ“ Listing all files and folders..."
      #     tree -a

      - name: List all folders
        run: |
          ls -l
      - name: Debug - Verify SQL Files
        run: |
          echo "ğŸ“ Verifying SQL files in sqlfiles/"
          ls -l ${{ github.workspace }}/sqlfiles

      - name: Lint SQL files
        run: |
          echo "ğŸ“„ Linting SQL files..."
          sqlfluff lint sql/ --dialect snowflake_with_iceberg
      
      # - name: Search for environment patterns
      #   run: |
      #     if grep -rnw '.' -e '@dev@' -e '@test@' -e '@prod@'; then
      #       echo "âŒ Environment pattern found. Failing the workflow."
      #       exit 1
      #     else
      #       echo "âœ… No environment patterns found."
      #     fi
